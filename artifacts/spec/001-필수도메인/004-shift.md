# 근무조(Shift) 도메인 모델

## 모델링 바이브

- Shift 바이브
    - 연속성과 교대 (Continuity & Rotation): 공장은 멈추지 않습니다. 주간/야간/비번 등 복잡한 로테이션 규칙이 모델에 녹아있어야 합니다.
    - 자원 최적화 (Resource Allocation): 특정 시간대에 숙련공이 부족하지 않은지, 인원 배치가 적절한지 판단하는 기준이 됩니다.
    - 규정 준수 (Compliance): 근로 기준법(주 52시간 등)에 따른 휴게 시간과 근무 간격이 엄격하게 관리되는 바이브입니다.
    - 공장은 24시간 돌아가지만, 시스템은 '정해진 시간에, 승인된 장소에서, 출근 확인이 된 사람'에게만 허락한다. 그리고 그 예외(대근 등)는 반드시 결재를 거쳐야 하며 모든 기록은 로그로 남는다.
- 유비쿼터스 언어 점검
    - Roster (근무 명부): 누가 언제 근무하는지 적힌 전체 시간표.
    - Overtime (연장 근로): 정해진 `Shift Template` 시간을 초과하여 근무하는 행위.
    - Substitute (대근): 원래 배정된 인원 대신 다른 인원이 투입되는 비상 상황.
    - Shift Rotation (교대 주기): 주간조에서 야간조로 변경되는 주기적인 흐름.
- 액티비트 흐름
        
    | 구분 | ID | 액티비티 명 | 상세 내용 |
    | --- | --- | --- | --- |
    | 운영 | K | 근무조 템플릿 설계 | 근무 시간대(Day/Night) 및 휴게 시간 정의 |
    | 운영 | L | 스케줄링 및 배정 | 유저/그룹별 월간 근무 편성표 작성 |
    | 실행 | M | 출퇴근 기록 및 검증 | 스케줄 대조를 통한 근태 상태(정상/지각 등) 확정 |
    | 실행 | T | 근무 시간 인가 제어 | 근무 중인 사람만 핵심 기능에 접근 가능하도록 제한 |
    | 실행 | U | 대근/비상 근무 활성화 | 비정규 근무자에 대한 임시 권한 허용 및 로그 기록 |
    
- 외부 도메인과의 관계
    1. User 도메인: User는 하나 이상의 `Work Group`에 소속되어 있으며, 본인의 `Shift Schedule`을 가집니다.
    2. 인가 엔진(Menu/Permission): 고권한 설비 제어 버튼은 "본인의 근무 시간(Shift) 내에만" 활성화되도록 `맥락 검증(G)` 로직에 추가됩니다.
    3. Audit Log: 근무 시간 외에 발생한 로그는 "비근무 시간 접속"이라는 특이사항 플래그를 달아 기록합니다.
    4. 결재(Approval)와의 결합: 연장 근무나 대근(Activity U)은 사전에 결재 도메인을 통해 승인된 문서가 있어야만 시스템에서 활성화됩니다.
    5. 결재(Approval) 도메인과의 시퀀스: * 사용자가 '대근(Substitute)' 요청 기안 -> 결재 승인 완료 -> Activity U 자동 트리거 -> 스케줄 모델의 `status`가 `SUBSTITUTED`로 변경 -> 인가 엔진 통과.

---

## Model

근무조는 크게 '근무 패턴(정의)'과 '실제 할당(실행)'으로 나뉩니다.

### A. Shift Template (근무조 템플릿)

근무의 종류를 정의하는 마스터 정보입니다.

- `shiftTemplateId`: PK
- `shiftName`: 주간(Day), 야간(Night), 오후(Swing) 등
- `startTime` / `endTime`: 근무 시작 및 종료 시간
- `breakTimeMinutes`: 법정 휴게 시간
- `isOvernight`: 익일 퇴근 여부 (야간조 판단 플래그)
- `allowLateThreshold`: 몇 분까지 지각으로 처리하지 않을 것인지에 대한 임계값 (Activity M 지원)
- `isHighRiskShift`: 사고 위험이 높은 시간대(예: 심야)인지 여부. (인가 엔진 G에서 더 깐깐한 검증을 유도하는 플래그)

### B. Shift Schedule (근무 스케줄)

특정 날짜에 특정 User가 어떤 근무조에 배치되었는지 기록합니다.

- `scheduleId`: PK
- `userId`: FK (User 도메인 연결)
- `shiftTemplateId`: FK (Template 연결)
- `workDate`: 실제 근무 날짜
- `status`: `ASSIGNED`(배정), `CONFIRMED`(확정), `ABSENT`(결근), `VACATION`(휴가)
- `actualStartTime / actualEndTime`: 실제 출퇴근 시간 기록 (Activity M의 타임스탬프 저장용)
- `approvalDocId`: (Activity U 관련) 대근이나 비상 근무 시 참조할 결재 문서 ID (결재 도메인과의 연결 고리)

### C. Work Group (근무 그룹)

여러 명의 User를 하나의 팀으로 묶어 교대 근무를 돌리는 단위입니다.

- `workGroupId`: PK
- `groupName`: 1조, 2조 또는 A팀, B팀
- `rotationPattern`: 교대 주기 규칙 (예: 4조 3교대, 주-주-야-야-비-비)

---

## Activity

## 운영 및 관리

### K. 근무조 템플릿 설계 (Shift Design)

- 행위: 운영 관리자가 공장 가동 계획에 맞춰 근무 시간대와 휴게 시간을 설정합니다.
- 보안/정책: 야간 근무조의 경우 추가 수당이나 특별 보안 권한이 필요한지 여부를 설정과 연동합니다.

### L. 스케줄링 및 배정 (Rostering)

- 행위: 특정 기간(주간/월간) 동안 직원들을 근무조에 배치합니다.
- 로직: `Work Group`의 로테이션 패턴에 따라 시스템이 자동으로 스케줄을 생성(Auto-generation)하거나 관리자가 수동으로 조정합니다.

## 실행 및 연동

### M. 출입 및 권한 연동 (Access-Shift Interlock)

인가 엔진과 연동되는 핵심 액티비티입니다.

- 행위: 사용자가 시스템에 접속하거나 현장 설비에 접근할 때, 현재가 본인의 근무 시간인지 검증합니다.
- 로직: `Shift Schedule`을 조회하여 현재 시간이 근무 시간 밖이라면 인가 엔진(`Activity G`)에서 접근을 제한하거나 경고 로그를 남깁니다.

T. 근무 시간 기반 인가 제어 (Shift-Lock Authorization)

- 행위: 인가 엔진의 맥락 검증(Activity G) 과정에서 호출됩니다.
- 로직: 현재 시간이 사용자의 `Shift Schedule` 범위 내인지 확인하여, 근무 시간 외에는 고권한 기능(설비 제어, 데이터 대량 추출 등)을 차단하거나 추가 승인을 요구합니다. "스케줄 내 시간인가?" 뿐만 아니라 "Activity M을 통해 출근(Check-in)이 완료된 상태인가?"를 조건에 추가하면, 스케줄표에는 있지만 실제로는 현장에 없는 사용자가 원격으로 설비를 조작하는 보안 사고를 막을 수 있습니다.

U. 대근 및 비상 근무 활성화 (Substitute/Emergency Activation)

- 행위: 갑작스러운 인원 공백으로 인해 다른 사용자가 대신 근무하거나 연장 근무를 해야 할 때 발생합니다.
- 결과: 임시로 해당 시간대의 접근 권한을 허용하고, 이 특이사항을 Audit Log에 '대근' 플래그와 함께 기록합니다.

---